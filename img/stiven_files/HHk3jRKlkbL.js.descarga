if (self.CavalryLogger) { CavalryLogger.start_js(["sbtON"]); }

__d("PhotoEditorImageData",[],(function(a,b,c,d,e,f){__p&&__p();var g=function(a,b,c,d){"use strict";this.r=a,this.g=b,this.b=c,this.a=d};g.fromArray=function(a,b){return new g(a[b],a[b+1],a[b+2],a[b+3])};a=function(){"use strict";__p&&__p();function a(a){this.image_data=a,this.width=a.width,this.height=a.height,this.array=a.data}var b=a.prototype;b.getData=function(){return this.image_data};b.getWidth=function(){return this.width};b.getHeight=function(){return this.height};b.getPixel=function(a,b){a=this.getIndex(a,b);return g.fromArray(this.array,a)};b.setPixel=function(a,b,c){a=this.getIndex(a,b);this.array[a]=c.r;this.array[a+1]=c.g;this.array[a+2]=c.b;this.array[a+3]=c.a};b.getIndex=function(a,b){return 4*(a+b*this.width)};b.forEach=function(a){for(var b=0;b<this.getWidth();b++)for(var c=0;c<this.getHeight();c++)this.setPixel(b,c,a(this.getPixel(b,c)))};return a}();a.Pixel=g;e.exports=a}),null);
__d("PhotoEditorCanvas",["BlobFactory","DOM","PhotoEditorImageData","PhotoResizeModeConst","Vector","sprintf"],(function(a,b,c,d,e,f){__p&&__p();c=function(){"use strict";__p&&__p();function c(a){this._editor=a,this._canvas=b("DOM").create("canvas"),this._ctx=this._canvas.getContext("2d"),this._drawHandler=null}var d=c.prototype;d.setImageContent=function(a){this._canvas.width=a.width;this._canvas.height=a.height;this._ctx.drawImage(a,0,0);return this};d.drawGraphic=function(){this._ctx.drawImage.apply(this._ctx,arguments);return this};d.isBlobSupported=function(){return!!this._canvas.toBlob};d.getElement=function(){return this._canvas};d.getDimensions=function(){return new(b("Vector"))(this._canvas.width,this._canvas.height,"document")};d.getWidth=function(){return this._canvas.width};d.getHeight=function(){return this._canvas.height};d.getContext=function(){return this._ctx};d.setWidth=function(a){this._canvas.width=a;return this};d.setHeight=function(a){this._canvas.height=a;return this};d.toBlob=function(a){if(this.isBlobSupported()){this._canvas.toBlob(a);return}this.getBlobFromDataURL(a)};d.getBlobFromDataURL=function(c){var d=this.toDataURL("image/png"),e=d.match(/^data:(.*?);base64,/),f=e[1];d=d.substr(e[0].length);e=a.atob(d);d=new ArrayBuffer(e.length);var g=new Uint8Array(d);for(var h=0;h<e.length;h++)g[h]=e.charCodeAt(h);g=b("BlobFactory").getBlob([d],{type:f});c(g)};d.toBlobURL=function(b){this.toBlob(function(c){b(a.URL.createObjectURL(c))})};d.toURL=function(a){if(this.isBlobSupported()){this.toBlobURL(a);return}a(this.toDataURL())};d.toDataURL=function(a){return this._canvas.toDataURL(a)};d.resizedCopy=function(a,b){__p&&__p();var c=a.x/this.getWidth();a=a.y/this.getHeight();if(b=="s")if(c>a)return this.scaledCopy(a);else return this.scaledCopy(c);else if(b=="p")if(c<a)return this.scaledCopy(a);else return this.scaledCopy(c);else throw new Error("mode must be one of PhotoResizeModeConst")};d.scaledCopy=function(a){var b=this._canvas.width*a;a=this._canvas.height*a;return new c().setWidth(b).setHeight(a).drawGraphic(this._canvas,0,0,b,a)};d.copy=function(){return this.scaledCopy(1)};d.getPixelColor=function(a,c,d){a=new(b("PhotoEditorImageData"))(this.getImageData(a,c,1,1)).getPixel(0,0);d&&(a=d(a));return b("sprintf")("rgba(%s,%s,%s,%s)",a.r,a.g,a.b,a.a)};d.getImageData=function(a,b,c,d){return this._ctx.getImageData(a||0,b||0,c||this.getWidth(),d||this.getHeight())};d.putImageData=function(a,b,c){this._ctx.putImageData(a,b||0,c||0);return this};d.toDataURI=function(){return this._canvas.toDataURL("image/png")};d.toBase64=function(){var a="data:image/png;base64,",b=this.toDataURI();return b.slice(a.length)};d.applyFilter=function(a,b){this.putImageData(new a(this).run(b))};d.enableDrawing=function(a,b){if(!this._editor)return;this.disableDrawing();this._drawHandler=new a(this._editor,b).start();return this._drawHandler};d.setDrawingFillStyle=function(a){if(!this._drawHandler)return;this._drawHandler.setFillStyle(a)};d.setFillStyle=function(a){this._ctx.fillStyle=a};d.disableDrawing=function(){if(!this._drawHandler)return;this._drawHandler.stop();this._drawHandler=null};d.clear=function(){this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height);return this};d.crop=function(a,b,d,e){var f=new c().setWidth(d).setHeight(e);f.drawGraphic(this._canvas,Math.max(0,a),Math.max(0,b),d,e,0,0,d,e);this.setImageContent(f.getElement());return this};d.fillText=function(a,b,c,d,e,f){this._ctx.font=b;f&&(this._canvas.width=this._ctx.measureText(a).width,this._ctx.font=b);this._ctx.textBaseline="top";this._ctx.fillStyle=c;this._ctx.fillText(a,d,e);return this};d.fillCircle=function(a,b,c,d){this._ctx.fillStyle=d||"black",this._ctx.beginPath(),this._ctx.arc(a,b,c,0,Math.PI*2),this._ctx.closePath(),this._ctx.fill()};d.fillRect=function(a,b,c,d,e){this._ctx.fillStyle=e||"black";this._ctx.fillRect(a||0,b||0,c||this._canvas.width,d||this._canvas.height);return this};return c}();e.exports=c}),null);
__d("PhotoEditorFont",["PhotoEditorConfig","sprintf"],(function(a,b,c,d,e,f){__p&&__p();var g=b("PhotoEditorConfig").Constants,h=function(){"use strict";__p&&__p();function a(a,b,c){this.$1=a||g.DEFAULT_FONT_FAMILY,this.$2=b||g.DEFAULT_FONT_SIZE,this.$3=c||g.DEFAULT_FONT_METRIC}var c=a.prototype;c.setFamily=function(a){this.$1=a};c.getFamily=function(){return this.$1};c.setSize=function(a){this.$2=a};c.getSize=function(){return this.$2};c.setMetric=function(a){this.$3=a};c.getMetric=function(){return this.$3};c.toString=function(){return b("sprintf")("%s%s %s",this.$2,this.$3,this.$1)};c.copy=function(){return new a(this.$1,this.$2,this.$3)};return a}();h.getDefault=function(){return new h()};e.exports=h}),null);
__d("PhotoEditorGraphic",["cx","fbt","ArbiterMixin","CSS","DOM","Draggable","Event","PhotoEditorCanvas","PhotoEditorFont","Rect","SimpleDrag","Style","SubscriptionsHandler","Vector","clamp","emptyFunction","mixin","throttle"],(function(a,b,c,d,e,f,g,h){__p&&__p();var i=0,j=[],k=.7,l=.25,m=30,n=50,o=4,p=.8,q=150,r=5,s=function(a){return{"-webkit-transform":a,"-moz-transform":a,"-ms-transform":a,transform:a}},t=function(a,c){var d=a.x*c.x+a.y*c.y;d=d/(a.magnitude()*c.magnitude());d=b("clamp")(d,-1,1);d=Math.acos(d)*(180/Math.PI);c=a.x*c.y-c.x*a.y;c<0&&(d*=-1);return d},u=function(){"use strict";__p&&__p();function a(){__p&&__p();var a=this,c;this.root=b("DOM").create("div");(c=b("CSS")).addClass(this.root,"_5g8y");c.addClass(this.root,"_5a2z");var d=b("DOM").create("div");c.addClass(d,"_2fb7");c.addClass(d,"_5a2-");this.root.appendChild(d);this.$1=b("emptyFunction");this.$2=b("emptyFunction");this.$3=b("emptyFunction");c=new(b("SimpleDrag"))(this.root);c.subscribe("start",function(c,d){if(d.button!==0)return!1;a.$4=!0;b("CSS").addClass(a.root,"_2fb8");a.$1(d)});c.subscribe("update",b("throttle")(this.$5,m,this));c.subscribe("end",function(c,d){a.$4=!1,b("CSS").removeClass(a.root,"_2fb8"),b("Style").apply(a.root,s("translate(50%, -50%)")),a.$2(d)})}var c=a.prototype;c.$5=function(a,b){if(!this.$4)return;this.$3(b)};c.setDragStartHandler=function(a){this.$1=a;return this};c.setDragMoveHandler=function(a){this.$3=a;return this};c.setDragEndHandler=function(a){this.$2=a;return this};c.getElement=function(){return this.root};return a}(),v=function(){"use strict";__p&&__p();function c(){this.$1=new(b("Vector"))(),this.$2=new XMLSerializer(),this.$3=void 0}var d=c.prototype;d.setDimensions=function(a){this.$1=a;return this};d.render=function(a){a='<svg xmlns="http://www.w3.org/2000/svg" width="'+this.$1.x+'" height="'+this.$1.y+'"><foreignObject width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml">'+this.$2.serializeToString(a)+"</div></foreignObject></svg>";var b=new Image();b.width=this.$1.x;b.height=this.$1.y;b.src=this.$4(a);return b};d.$4=function(b){return"data:image/svg+xml;base64,"+a.btoa(b)};return c}();d=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c,d,e){__p&&__p();var f;f=a.call(this)||this;f.id=i++;f.photoEditor=c;j.push(babelHelpers.assertThisInitialized(f));f.root=b("DOM").create("div");f.maxWidth=d;f.maxHeight=e;b("CSS").addClass(f.root,"_55gm");var g=b("DOM").create("button");b("CSS").addClass(g,"_5g8y");b("CSS").addClass(g,"_bbn");b("DOM").setAttributes(g,{"aria-label":h._("Remove")});c=b("DOM").create("div");b("CSS").addClass(c,"_2fb7");b("CSS").addClass(c,"_bbo");g.appendChild(c);f.root.appendChild(g);f.$Graphic1=b("DOM").create("div");b("CSS").addClass(f.$Graphic1,"_5lzw");f.$Graphic1.appendChild(f.root);f.$Graphic2=new(b("Vector"))(0,0,"document");f.subscriptionsHandler=new(b("SubscriptionsHandler"))();f.subscriptionsHandler.addSubscriptions(b("Event").listen(g,"click",f.remove.bind(babelHelpers.assertThisInitialized(f))),b("Event").listen(g,"mousedown",function(a){b("CSS").addClass(g,"_2fb8"),a.stopPropagation()}),b("Event").listen(g,"mouseleave",function(a){b("CSS").removeClass(g,"_2fb8")}));return f}var d=c.prototype;d.serialize=function(){var a=this.getPos(),b=this.getDimensions(),c=this.photoEditor.getCanvasDimensions();return{type:this.constructor,left:a.x/c.x,top:a.y/c.y,width:b.x/c.x,height:b.y/c.y,rotation:this.getRotation()}};d.initFromSerializedState=function(a){var c=this.photoEditor.getCanvasDimensions();this.setDimensions(new(b("Vector"))(a.width*c.x,a.height*c.y));this.setPos(new(b("Vector"))(a.left*c.x,a.top*c.y));this.setRotation(a.rotation)};d.onActive=function(){this.__draggable=this.__draggable||new(b("Draggable"))(this.$Graphic1).setUseAbsolute(!0).setUseScroller(!1).addHandle(this.root).setDragHandler(this.onDrag.bind(this)).setDropHandler(this.onDrop.bind(this)),b("CSS").addClass(this.root,"_36w9"),this.updateDraggableBoundingBox()};d.onInactive=function(){this.__draggable&&this.__draggable.destroy(),this.__draggable=null,b("CSS").removeClass(this.root,"_36w9")};d.updateDraggableBoundingBox=function(){if(this.__draggable){var a=this.getDimensions(),c=this.photoEditor.getGraphicsLayer(),d=b("Vector").getElementPosition(c);c=b("Vector").getElementDimensions(c);c=new(b("Rect"))(d.y-.25*a.y,d.x+c.x+.25*a.x,d.y+c.y+.25*a.y,d.x-.25*a.x);this.__draggable.setBoundingBox(c)}};d.onBeforeSuddenTransformation=function(){};d.onAfterSuddenTransformation=function(){};d.getElement=function(){return this.$Graphic1};d.getInitialDimensions=function(){return new(b("Vector"))(this.maxWidth,this.maxHeight,"document").mul(l)};d.getPos=function(){return this.$Graphic2};d.getCenterPos=function(){return this.getPos().add(this.getDimensions().div(2))};d.getCenterCoordinates=function(){return b("Vector").getElementPosition(this.$Graphic1).add(this.getDimensions().div(2))};d.isRemoved=function(){return!this.$Graphic1.parentNode};d.setPos=function(a){this.$Graphic2=a,b("Style").apply(this.$Graphic1,{left:this.$Graphic2.x+"px",top:this.$Graphic2.y+"px"})};d.updatePos=function(){this.setPos(this.getNewPos())};d.getNewPos=function(){return new(b("Vector"))(b("Style").get(this.$Graphic1,"left"),b("Style").get(this.$Graphic1,"top"))};d.setDimensions=function(a){b("Style").apply(this.root,{width:a.x+"px",height:a.y+"px"}),this.updateDraggableBoundingBox()};d.remove=function(a){this.subscriptionsHandler.release(),b("DOM").remove(this.$Graphic1),this.photoEditor.removeGraphic(this)};d.getDrawableObj=function(){};d.getDimensions=function(){return b("Vector").getElementDimensions(this.$Graphic1)};d.getDimensionsForDrawable=function(){return b("Vector").getElementDimensions(this.root)};d.getRotation=function(){return 0};d.setRotation=function(a){};d.onDrag=function(a){};d.onDrop=function(a){this.updatePos()};return c}(b("mixin")(b("ArbiterMixin")));f=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c,d,e,f,g){__p&&__p();c=a.call(this,c,e,f)||this;c.$ImageGraphic1=b("DOM").create("div");b("CSS").addClass(c.$ImageGraphic1,"_36wa");c.root.appendChild(c.$ImageGraphic1);c.$ImageGraphic2=e/f;c.$ImageGraphic3=0;c.$ImageGraphic4=0;c.$ImageGraphic5=!0;c.$ImageGraphic6=!0;c.$ImageGraphic7=Math.sqrt(2);c.$ImageGraphic8=!1;c.$ImageGraphic9=new Image();c.$ImageGraphic9.crossOrigin="anonymous";b("Style").apply(c.$ImageGraphic9,{maxWidth:e+"px",maxHeight:f+"px"});b("CSS").addClass(c.root,"_55jn");b("CSS").addClass(c.root,"loading");c.$ImageGraphic10=b("DOM").create("div");b("CSS").addClass(c.$ImageGraphic10,"_5a2y");g||c.$ImageGraphic11();c.subscriptionsHandler.addSubscriptions(b("Event").listen(c.$ImageGraphic9,"load",c.$ImageGraphic12.bind(babelHelpers.assertThisInitialized(c))),b("Event").listen(c.root,"dragenter",b("Event").prevent),b("Event").listen(c.root,"dragover",b("Event").prevent),b("Event").listen(c.$ImageGraphic1,"mousedown",c.$ImageGraphic13.bind(babelHelpers.assertThisInitialized(c))));c.$ImageGraphic9.src=d;c.imageURL=d;c.setDimensions(c.getInitialDimensions());return c}var d=c.prototype;d.serialize=function(){return babelHelpers["extends"]({},a.prototype.serialize.call(this),{imageURL:this.imageURL})};d.getDrawableObj=function(){return this.$ImageGraphic9};d.onDragStart=function(b){a.prototype.onDragStart.call(this,b),b.dataTransfer.setData("text/plain",this.$ImageGraphic9.src)};d.$ImageGraphic11=function(){var a=this,c=new u();this.$ImageGraphic10.appendChild(c.getElement());this.root.appendChild(this.$ImageGraphic10);this.subscriptionsHandler.addSubscriptions(b("Event").listen(c.getElement(),"mousedown",function(a){a.stopPropagation()}));c.setDragStartHandler(function(){a.$ImageGraphic14=a.getCenterCoordinates(),a.$ImageGraphic15()}).setDragMoveHandler(this.$ImageGraphic16.bind(this)).setDragEndHandler(function(){a.$ImageGraphic3=a.$ImageGraphic4,a.$ImageGraphic17(),a.$ImageGraphic18()});this.$ImageGraphic19=c};d.$ImageGraphic16=function(a){__p&&__p();a=b("Vector").getEventPosition(a);var c=this.getDimensions(),d=c.magnitude();d=c.div(d);var e=this.$ImageGraphic14,f=e.distanceTo(a);f=b("clamp")(f*2,n,Math.max(this.maxWidth,this.maxHeight))*this.$ImageGraphic7;f=d.mul(f);f.x=f.y*this.$ImageGraphic20;c=f.sub(c);if(c.magnitude()>o){c=this.getPos().sub(c.div(2));this.setDimensions(f);this.setPos(c)}if(this.$ImageGraphic5===!0){f=a.sub(e);c=d.mul(1,-1);a=t(c,f);this.$ImageGraphic21(a)}this.updatePos();this.$ImageGraphic22&&this.$ImageGraphic22()};d.setPostFreeformEditDragHandler=function(a){this.$ImageGraphic22=a};d.$ImageGraphic21=function(a){this.$ImageGraphic4=this.$ImageGraphic3+a,b("Style").apply(this.$ImageGraphic1,s("rotate("+this.$ImageGraphic4+"deg)")),this.$ImageGraphic23(this.$ImageGraphic24+a),b("Style").apply(this.$ImageGraphic19.getElement(),s("translate(50%, -50%) rotate("+a+"deg)"))};d.$ImageGraphic18=function(){this.$ImageGraphic23(this.$ImageGraphic24)};d.$ImageGraphic17=function(){b("Style").set(this.$ImageGraphic10,"transition","transform 0.3s cubic-bezier(.08,.98,.15,1.09)")};d.$ImageGraphic15=function(){b("Style").set(this.$ImageGraphic10,"transition","")};d.$ImageGraphic23=function(a){b("Style").apply(this.$ImageGraphic10,s("rotate("+a+"deg) translateX("+this.getDimensions().magnitude()/(2*this.$ImageGraphic7)+"px) rotate("+-1*a+"deg)"))};d.$ImageGraphic13=function(a){this.photoEditor.setActiveGraphic(this)};d.$ImageGraphic12=function(){b("CSS").removeClass(this.root,"loading");b("CSS").addClass(this.root,"loaded");this.$ImageGraphic2=this.$ImageGraphic9.width/this.$ImageGraphic9.height;var a=new(b("PhotoEditorCanvas"))();a.setImageContent(this.$ImageGraphic9);b("Style").set(this.$ImageGraphic1,"backgroundImage","url("+a.toDataURL()+")");this.setDimensions(this.getDimensions());this.updatePos();this.inform("loaded")};d.setPos=function(c){a.prototype.setPos.call(this,c);c=this.$ImageGraphic25();b("Style").apply(this.$ImageGraphic1,{left:c.x+"px",top:c.y+"px"})};d.setDimensions=function(a){this.$ImageGraphic20=this.$ImageGraphic6?1:a.x/a.y;b("Style").apply(this.root,{height:(this.$ImageGraphic6?a.x:a.y)+"px",width:a.x+"px"});this.$ImageGraphic24=-Math.atan2(a.y,a.x)*180/Math.PI;var c=this.getImageScale();a=new(b("Vector"))(a.x,this.$ImageGraphic6?a.x:a.y).mul(c.x,c.y);b("Style").apply(this.$ImageGraphic1,{height:Math.round(a.y)+"px",width:Math.round(a.x)+"px"});this.$ImageGraphic18();this.updateDraggableBoundingBox()};d.getImageScale=function(){var a=this.$ImageGraphic2>1?new(b("Vector"))(1,1/this.$ImageGraphic2):new(b("Vector"))(this.$ImageGraphic2,1);return a.mul(k)};d.$ImageGraphic25=function(){var a=this.getDimensions(),b=this.getDimensionsForDrawable();return a.sub(b).div(2)};d.getInitialDimensions=function(){var a=Math.min(this.maxWidth,this.maxHeight);return new(b("Vector"))(a,a,"document").mul(l)};d.getDimensionsForDrawable=function(){return b("Vector").getElementDimensions(this.$ImageGraphic1)};d.getRotation=function(){return this.$ImageGraphic4};d.setRotation=function(a){this.$ImageGraphic3=this.$ImageGraphic4=a,b("Style").apply(this.$ImageGraphic1,s("rotate("+this.$ImageGraphic3+"deg)"))};d.setAllowRotation=function(a){this.$ImageGraphic5=a;return this};d.setCircleBoundingBox=function(a){this.$ImageGraphic6=a;this.$ImageGraphic7=a?Math.sqrt(2):1;return this};d.onBeforeSuddenTransformation=function(){this.$ImageGraphic15()};d.onAfterSuddenTransformation=function(){this.$ImageGraphic17()};return c}(d);g=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(c,a);function c(b,c,d,e,f,g){b=a.call(this,b,d,e,f,g)||this;b.$StickerGraphic1=c;return b}var d=c.prototype;d.serialize=function(){return babelHelpers["extends"]({},a.prototype.serialize.call(this),{sticker_id:this.$StickerGraphic1})};d.onActive=function(){a.prototype.onActive.call(this),b("CSS").addClass(this.photoEditor.getCanvasWrapper(),"_61d-")};d.onInactive=function(){a.prototype.onInactive.call(this),b("CSS").removeClass(this.photoEditor.getCanvasWrapper(),"_61d-")};return c}(f);var w=function(c){"use strict";__p&&__p();babelHelpers.inheritsLoose(a,c);function a(d,e,f,g,h,i,j,k,l,m){__p&&__p();var n;n=c.call(this,d,k,l)||this;n.$TextGraphic1=new Image();n.$TextGraphic2=g;n.$TextGraphic3=new(b("PhotoEditorFont"))(f);n.$TextGraphic4=null;n.$TextGraphic5=0;n.$TextGraphic6=1;n.$TextGraphic7=0;n.$TextGraphic8=new v().setDimensions(a.ImageSettings.DIMENSIONS);n.$TextGraphic9=i;n.$TextGraphic10=b("DOM").create("textarea");b("Style").apply(n.$TextGraphic10,{position:"absolute",width:a.ImageSettings.WIDTH+"px",padding:"0px",margin:"0px",border:"none",overflow:"hidden",resize:"none",background:"transparent"});j=b("DOM").create("div",{className:"_3bul"});b("Style").set(j,"width",a.ImageSettings.WIDTH+"px");j.appendChild(n.$TextGraphic10);n.root.appendChild(j);n.$TextGraphic11=h||new(b("Vector"))(0,0,"document");n.focusInput=b("DOM").create("textarea",{className:"_5g78"});n.$TextGraphic12=b("DOM").create("div",{className:"_5l-2"});n.root.appendChild(n.focusInput);n.root.appendChild(n.$TextGraphic12);b("CSS").addClass(n.root,"loaded");b("CSS").addClass(n.root,"_5g79");n.subscriptionsHandler.addSubscriptions(b("Event").listen(n.$TextGraphic12,"click",function(){n.focusInput.focus()}),b("Event").listen(n.focusInput,"blur",function(){b("CSS").removeClass(n.root,"_5g7a")}),b("Event").listen(n.focusInput,"focus",function(){d.setActiveGraphic(babelHelpers.assertThisInitialized(n)),b("CSS").addClass(n.root,"_5g7a"),n.adjustFontSizeFit()}),b("Event").listen(n.focusInput,"keyup",b("throttle")(n.$TextGraphic13,50,babelHelpers.assertThisInitialized(n))));m||n.$TextGraphic14();g=Math.min(k,l)*p;f=g/a.ImageSettings.WIDTH;n.$TextGraphic6=f;n.$TextGraphic15=new(b("Vector"))(g,f*a.ImageSettings.HEIGHT,"document");n.$TextGraphic15.setElementDimensions(n.root);n.updateText(e);return n}var d=a.prototype;d.getInitialDimensions=function(){return this.$TextGraphic15};d.$TextGraphic16=function(a){__p&&__p();if(this.$TextGraphic17!==!0){var c=b("Vector").getEventPosition(a),d=this.getDimensions(),e=d.magnitude();e=d.div(e);var f=this.$TextGraphic18,g=f.distanceTo(c),h=this.photoEditor.getCanvasDimensions();h=Math.max(h.x,h.y);g=b("clamp")(g*2,n,h);h=e.mul(g);e=h.sub(d);if(e.magnitude()>o){g=this.getPos().sub(e.div(2));this.setDimensions(h);this.setPos(g)}e=f.sub(c);h=t(d.mul(-1,1),e);h=(h+360)%360;(h%90<r||h%90>90-r)&&(h=Math.round(h/90)*90);this.setRotation(h);this.updateDraggableBoundingBox();this.updatePos()}else originalDims=this.getDimensions(),cursorPos=b("Vector").getEventPosition(a),center=this.$TextGraphic18,distToCenter=center.sub(cursorPos),newDims=distToCenter.mul(-2,2),diff=newDims.sub(originalDims),diff.magnitude()>o&&(newPos=this.getPos().sub(diff.div(2)),this.setDimensions(newDims),this.setPos(newPos));this.$TextGraphic19&&this.$TextGraphic19()};d.setPostFreeformEditDragHandler=function(a){this.$TextGraphic19=a};d.$TextGraphic14=function(){var a=this,c=new u();this.root.appendChild(c.getElement());this.subscriptionsHandler.addSubscriptions(b("Event").listen(c.getElement(),"mousedown",function(a){a.stopPropagation()}));c.setDragStartHandler(function(){a.$TextGraphic18=a.getCenterCoordinates()}).setDragMoveHandler(this.$TextGraphic16.bind(this))};d.setAllowChangeAspectRatio=function(a){this.$TextGraphic17=a};d.$TextGraphic13=function(){var a=this.focusInput.value;a.length>q&&(this.focusInput.value=a.substr(0,q));this.updateText(this.focusInput.value)};d.onActive=function(){c.prototype.onActive.call(this),this.focusInput.focus(),this.inform("focus")};d.onInactive=function(){c.prototype.onInactive.call(this);this.focusInput.blur();b("CSS").removeClass(this.root,"_5g7a");this.inform("blur");var a=this.$TextGraphic4.replace(/^\s*/,"").replace(/\s*$/,"");a.length||this.remove()};d.getRotation=function(){return this.$TextGraphic5};d.setRotation=function(a){this.$TextGraphic5=a,b("Style").apply(this.root,s("rotate("+this.$TextGraphic5+"deg)"))};d.setDimensions=function(c){this.$TextGraphic6=c.x/a.ImageSettings.WIDTH,b("Style").apply(this.root,{width:c.x+"px",height:this.$TextGraphic6*a.ImageSettings.HEIGHT+"px"}),this.$TextGraphic20()};d.getDrawableObj=function(){return this.$TextGraphic1};d.getTextAlign=function(){return this.$TextGraphic9};d.getText=function(){return this.$TextGraphic4};d.getFillStyle=function(){return this.$TextGraphic2};d.getFontFamily=function(){return this.$TextGraphic3.getFamily()};d.updateText=function(a,c,d){d&&(this.$TextGraphic2=d),c&&this.$TextGraphic3.setFamily(c),typeof a==="string"&&(a=a.substr(0,q),this.$TextGraphic4!=a&&(this.focusInput.value=this.$TextGraphic4=a,this.$TextGraphic10.innerText=this.$TextGraphic10.textContent=a)),b("Style").apply(this.focusInput,{textAlign:this.$TextGraphic9,color:this.$TextGraphic2,fontFamily:this.$TextGraphic3.getFamily()}),b("Style").apply(this.$TextGraphic10,{textAlign:this.$TextGraphic9,font:this.$TextGraphic3.toString(),color:this.$TextGraphic2}),this.adjustFontSizeFit(),this.$TextGraphic1=this.$TextGraphic8.render(this.$TextGraphic10)};d.adjustFontSizeFit=function(){var c=a.ImageSettings.MAX_FONT;this.$TextGraphic3.setSize(c);b("Style").apply(this.$TextGraphic10,{font:this.$TextGraphic3.toString(),height:"0px"});while(this.$TextGraphic10.scrollHeight>a.ImageSettings.HEIGHT)this.$TextGraphic3.setSize(--c),b("Style").set(this.$TextGraphic10,"font",this.$TextGraphic3.toString());this.$TextGraphic7=(a.ImageSettings.HEIGHT-this.$TextGraphic10.scrollHeight)/2;b("Style").apply(this.$TextGraphic10,{marginTop:this.$TextGraphic7+"px",marginBottom:this.$TextGraphic7+"px",height:this.$TextGraphic10.scrollHeight+"px"});this.$TextGraphic20()};d.setFontSize=function(a){this.$TextGraphic3.setSize(a)};d.$TextGraphic20=function(){var c=this,d=this.$TextGraphic6,e=this.$TextGraphic10.clientHeight;window.setTimeout(function(){b("Style").apply(c.focusInput,{width:a.ImageSettings.WIDTH*d+"px",height:e*d+"px",marginTop:c.$TextGraphic7*d+"px",marginBottom:c.$TextGraphic7*d+"px",fontSize:c.$TextGraphic3.getSize()*d+"px"})},0)};d.setTextAlign=function(a){this.$TextGraphic9=a;this.updateText();return this};d.setText=function(a){this.updateText(a)};d.setFontFamily=function(a){this.$TextGraphic3.setFamily(a),this.updateText()};d.setFillStyle=function(a){this.$TextGraphic2=a,this.updateText()};d.getColorCoordinates=function(){return new(b("Vector"))(this.$TextGraphic11.x,this.$TextGraphic11.y,"document")};d.setColorCoordinates=function(a){this.$TextGraphic11=a};d.serialize=function(){return babelHelpers["extends"]({},c.prototype.serialize.call(this),{text:this.$TextGraphic4,fontFamily:this.$TextGraphic3.getFamily(),fill:this.$TextGraphic2,textAlign:this.$TextGraphic9,colorCoordinates:{x:this.$TextGraphic11.x,y:this.$TextGraphic11.y}})};d.initFromSerializedState=function(a){this.$TextGraphic9=a.textAlign,this.$TextGraphic11=a.colorCoordinates,this.updateText(a.text,a.fontFamily,a.fill),c.prototype.initFromSerializedState.call(this,a)};return a}(d);w.ImageSettings={WIDTH:200,HEIGHT:120,MAX_FONT:30,DIMENSIONS:new(b("Vector"))(200,120)};var x=function(c){"use strict";babelHelpers.inheritsLoose(b,c);function b(){return c.apply(this,arguments)||this}var d=b.prototype;d.remove=function(){c.prototype.remove.call(this),a.URL.revokeObjectURL(this.imageURL)};return b}(f);function c(a,b){j[a]&&j[a].onDrop(b)}e.exports={Blob:x,FreeFormEditButton:u,Graphic:d,Image:f,onDrop:c,Sticker:g,Text:w}}),null);